# ref https://raw.githubusercontent.com/nais/naisd/master/nais_example.yaml
image: docker.adeo.no:5000/fo/veilarbdemo
team: pus
replicas:
  min: 1
  max: 2
  cpuThresholdPercentage: 50
port: 8080
webproxy: true
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 200m
    memory: 256Mi
healthcheck:
  liveness:
    path: veilarbdemo/internal/isAlive
    initialDelay: 20
  readiness:
    path: veilarbdemo/internal/selftest
    initialDelay: 20
prometheus:
  enabled: true
  path: veilarbdemo/internal/metrics
fasitResources:
  used:
  - alias: srvveilarbdemo
    resourceType: credential
  - alias: appdynamics
    resourceType: applicationproperties
  - alias: oidc-stepup # brukes ikke av appen, kun for testing
    resourceType: restservice
  - alias: aad_b2c_discovery # brukes ikke av appen, kun for testing
    resourceType: baseurl



alerts:
- alert: restart-test-sbs
  expr: sum(kube_pod_container_status_restarts_total{pod=~"^veilarbdemo.+"}) > 0
  for: 5m
  labels:
    severity: Warning
  annotations:
    action: Restart

- alert: memory-sbs
  expr: (sum(container_memory_working_set_bytes{container_name=~"^veilarbdemo-fss$"}) - sum(kube_pod_container_resource_requests_memory_bytes{container=~"^veilarbdemo-fss$"})) > 50000000
  for: 30m
  labels:
    severity: Warning
  annotations:
    action: Restart


